# Markdown to DOCX 转换工具 - 轻量级架构设计

## 1. 设计理念

- **渐进式开发**：从最基础功能开始，逐步添加新特性
- **最小可用原则**：每个功能模块都可以独立运行和测试
- **简单易用**：降低架构复杂度，便于维护和打包发布
- **可测试性**：所有功能都要有对应的测试用例
- **文档驱动**：先文档后开发，保持文档与代码的一致性

## 2. 项目结构

```
md2docx/
├── src/                    # 源代码
│   ├── converter/         # 转换核心
│   │   ├── base.py       # 基础转换类
│   │   ├── __init__.py   # 包初始化
│   │   └── elements/     # 各类元素转换器
│   │       ├── base.py   # 基础元素转换器
│   │       ├── text.py   # 文本相关（段落、样式）
│   │       ├── heading.py # 标题转换
│   │       ├── list.py   # 列表转换
│   │       ├── code.py   # 代码块转换
│   │       ├── table.py  # 表格转换
│   │       ├── image.py  # 图片转换
│   │       ├── links.py  # 链接转换
│   │       ├── blockquote.py # 引用块转换
│   │       ├── hr.py     # 分隔线转换
│   │       ├── task_list.py # 任务列表转换
│   │       ├── html.py   # HTML标签转换
│   │       └── __init__.py # 包初始化
│   └── cli.py          # 命令行接口
├── tests/               # 测试用例
│   ├── unit/           # 单元测试
│   ├── integration/    # 集成测试
│   └── samples/        # 测试样例
│       ├── basic/      # 基础语法样例
│       └── advanced/   # 高级语法样例
├── docs/               # 文档
│   ├── architecture.md # 架构设计
│   ├── development.md  # 开发指南
│   └── testing.md     # 测试规范
├── batch_convert_test.py # 批量转换脚本
├── requirements.txt    # 项目依赖
├── pyproject.toml     # 项目配置
└── README.md          # 项目说明
```

## 3. 功能开发路线

### 阶段一：基础文本结构（已完成）
1. 标题转换（h1-h6）
   - 基础转换类设计
   - 标题层级和样式支持
   - 完整测试用例
2. 段落和文本样式
   - 段落格式
   - 粗体、斜体
   - 删除线
3. 引用块
   - 单层引用
   - 多层嵌套引用

### 阶段二：列表和代码（已完成）
1. 列表转换
   - 无序列表（* - +）
   - 有序列表（1. 2. 3.）
   - 多级列表缩进
2. 代码支持
   - 行内代码
   - 代码块
   - 基础语法高亮

### 阶段三：链接和图片（已完成）
1. 链接处理
   - 内联链接
   - 引用链接
   - URL 自动链接
2. 图片支持
   - 本地图片
   - 在线图片
   - 图片尺寸调整

### 阶段四：表格和分隔符（已完成）
1. 表格转换
   - 基础表格
   - 对齐方式
   - 表格样式
2. 分隔线
3. 任务列表（TODO）

### 阶段五：高级功能（TODO）
1. 数学公式（可选）
   - 行内公式
   - 块级公式
2. 流程图（可选）
3. HTML 标签支持（已完成基础支持）

### 阶段六：界面开发（TODO）
1. 基础编辑器
2. 实时预览
3. 导出功能
4. 样式配置

## 4. 核心设计

### 转换器设计
```python
class BaseConverter:
    """基础转换器，处理文档结构"""
    def convert(self, md_text: str) -> Document:
        pass

class ElementConverter:
    """元素转换器基类"""
    def convert(self, element: Any) -> Any:
        pass

# 示例：标题转换器
class HeadingConverter(ElementConverter):
    """处理 h1-h6 标题"""
    def convert(self, heading: Any) -> Any:
        pass
```

## 5. 开发原则

1. **独立性**
   - 每个转换器独立工作
   - 新功能不影响已有功能
   - 测试覆盖单一功能点

2. **简单依赖**
   - markdown-it-py：Markdown 解析
   - python-docx：DOCX 生成
   - PySide6：GUI（TODO - 后期添加）

3. **测试驱动**
   - 每个功能都有对应测试
   - 样例文档验证
   - 边界情况处理

## 6. 打包发布

1. **依赖管理**
   - 最小化依赖
   - 版本锁定
   - 虚拟环境隔离

2. **打包配置**
   - 使用 PyInstaller
   - 单文件模式
   - 资源文件打包

3. **发布检查**
   - 功能完整性验证
   - 依赖完整性检查
   - 启动性能优化

## 7. 当前阶段任务

1. ✅ 实现基础转换器
2. ✅ 完成标题转换功能
3. ✅ 编写对应测试用例
4. ✅ 验证导出功能
5. 🔲 开发图形界面（TODO）
6. 🔲 实现高级功能支持（TODO）

## 8. 开发规范

1. **代码风格**
   - 使用 Black 进行代码格式化
   - 类型注解必须完整
   - 函数必须有文档字符串

2. **提交规范**
   - feat: 新功能
   - fix: 修复问题
   - docs: 文档更新
   - test: 测试相关
   - refactor: 代码重构

3. **分支管理**
   - main: 主分支，稳定版本
   - develop: 开发分支
   - feature/*: 功能分支
   - release/*: 发布分支

## 9. 错误处理

1. **异常体系**
   ```python
   class MD2DocxError(Exception):
       """基础异常类"""
       pass

   class ParseError(MD2DocxError):
       """解析错误"""
       pass

   class ConvertError(MD2DocxError):
       """转换错误"""
       pass
   ```

2. **错误处理原则**
   - 提供清晰的错误信息
   - 保持文档状态一致性
   - 支持错误恢复

## 10. 版本规划

1. **v0.1.0**：基础文本结构（已完成）
   - 标题、段落、文本样式
   - 命令行接口

2. **v0.2.0**：列表和代码（已完成）
   - 所有类型列表
   - 代码块支持

3. **v0.3.0**：链接和图片（已完成）
   - 链接处理
   - 图片支持

4. **v0.4.0**：表格支持（已完成）
   - 基础表格
   - 样式定制

5. **v1.0.0**：完整功能（TODO）
   - GUI 界面
   - 所有基础功能
   - 打包发布 